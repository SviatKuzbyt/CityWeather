package ua.sviatkuzbyt.cityweather

import androidx.test.ext.junit.runners.AndroidJUnit4
import com.google.gson.Gson
import org.junit.runner.RunWith
import ua.sviatkuzbyt.cityweather.data.api.WeatherItemAppearance.Companion.getWeatherItemAppearance
import ua.sviatkuzbyt.cityweather.data.api.forecast.ForecastData
import ua.sviatkuzbyt.cityweather.data.api.forecast.ForecastTodayResponse
import java.time.Instant
import java.time.ZoneId
import java.time.format.DateTimeFormatter


@RunWith(AndroidJUnit4::class)
class GsonTest {
    private val response = """{"cod":"200","message":0,"cnt":40,"list":[{"dt":1737709200,"main":{"temp":2.1,"feels_like":2.1,"temp_min":2.1,"temp_max":2.1,"pressure":1018,"sea_level":1018,"grnd_level":978,"humidity":99,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":0.73,"deg":327,"gust":1.09},"pop":0.65,"rain":{"3h":0.32},"sys":{"pod":"d"},"dt_txt":"2025-01-24 09:00:00"},{"dt":1737720000,"main":{"temp":2.15,"feels_like":2.15,"temp_min":2.15,"temp_max":2.25,"pressure":1018,"sea_level":1018,"grnd_level":978,"humidity":99,"temp_kf":-0.1},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13d"}],"clouds":{"all":100},"wind":{"speed":0.67,"deg":58,"gust":0.54},"pop":0.21,"snow":{"3h":0.18},"sys":{"pod":"d"},"dt_txt":"2025-01-24 12:00:00"},{"dt":1737730800,"main":{"temp":2.15,"feels_like":2.15,"temp_min":2.15,"temp_max":2.17,"pressure":1019,"sea_level":1019,"grnd_level":979,"humidity":99,"temp_kf":-0.02},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":1.03,"deg":138,"gust":1.18},"pop":0.34,"rain":{"3h":0.2},"sys":{"pod":"d"},"dt_txt":"2025-01-24 15:00:00"},{"dt":1737741600,"main":{"temp":2.19,"feels_like":0.99,"temp_min":2.19,"temp_max":2.19,"pressure":1020,"sea_level":1020,"grnd_level":980,"humidity":93,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.34,"deg":168,"gust":1.56},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-24 18:00:00"},{"dt":1737752400,"main":{"temp":3.2,"feels_like":0.66,"temp_min":3.2,"temp_max":3.2,"pressure":1020,"sea_level":1020,"grnd_level":980,"humidity":81,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":2.62,"deg":186,"gust":3.02},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-24 21:00:00"},{"dt":1737763200,"main":{"temp":1.87,"feels_like":-1.28,"temp_min":1.87,"temp_max":1.87,"pressure":1020,"sea_level":1020,"grnd_level":980,"humidity":83,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":82},"wind":{"speed":3.03,"deg":167,"gust":3.41},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-25 00:00:00"},{"dt":1737774000,"main":{"temp":0.61,"feels_like":-2.3,"temp_min":0.61,"temp_max":0.61,"pressure":1020,"sea_level":1020,"grnd_level":980,"humidity":88,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":47},"wind":{"speed":2.5,"deg":180,"gust":2.92},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-25 03:00:00"},{"dt":1737784800,"main":{"temp":0.49,"feels_like":-2.75,"temp_min":0.49,"temp_max":0.49,"pressure":1020,"sea_level":1020,"grnd_level":980,"humidity":86,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":32},"wind":{"speed":2.82,"deg":165,"gust":3.49},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-25 06:00:00"},{"dt":1737795600,"main":{"temp":5.04,"feels_like":2.3,"temp_min":5.04,"temp_max":5.04,"pressure":1020,"sea_level":1020,"grnd_level":980,"humidity":65,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":49},"wind":{"speed":3.36,"deg":177,"gust":7.57},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-25 09:00:00"},{"dt":1737806400,"main":{"temp":7.64,"feels_like":5.22,"temp_min":7.64,"temp_max":7.64,"pressure":1019,"sea_level":1019,"grnd_level":980,"humidity":60,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":75},"wind":{"speed":3.77,"deg":199,"gust":7.22},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-25 12:00:00"},{"dt":1737817200,"main":{"temp":4.6,"feels_like":1.8,"temp_min":4.6,"temp_max":4.6,"pressure":1019,"sea_level":1019,"grnd_level":979,"humidity":76,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":90},"wind":{"speed":3.32,"deg":165,"gust":5.05},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-25 15:00:00"},{"dt":1737828000,"main":{"temp":2.2,"feels_like":-0.65,"temp_min":2.2,"temp_max":2.2,"pressure":1019,"sea_level":1019,"grnd_level":979,"humidity":85,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":82},"wind":{"speed":2.76,"deg":151,"gust":3.02},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-25 18:00:00"},{"dt":1737838800,"main":{"temp":1.91,"feels_like":-0.95,"temp_min":1.91,"temp_max":1.91,"pressure":1019,"sea_level":1019,"grnd_level":979,"humidity":81,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":81},"wind":{"speed":2.7,"deg":137,"gust":2.36},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-25 21:00:00"},{"dt":1737849600,"main":{"temp":1.48,"feels_like":-1.25,"temp_min":1.48,"temp_max":1.48,"pressure":1018,"sea_level":1018,"grnd_level":978,"humidity":77,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":81},"wind":{"speed":2.48,"deg":137,"gust":2.04},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-26 00:00:00"},{"dt":1737860400,"main":{"temp":1.88,"feels_like":-1.23,"temp_min":1.88,"temp_max":1.88,"pressure":1017,"sea_level":1017,"grnd_level":977,"humidity":70,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":97},"wind":{"speed":2.98,"deg":146,"gust":2.68},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-26 03:00:00"},{"dt":1737871200,"main":{"temp":1.87,"feels_like":-1.53,"temp_min":1.87,"temp_max":1.87,"pressure":1016,"sea_level":1016,"grnd_level":976,"humidity":67,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":87},"wind":{"speed":3.35,"deg":167,"gust":3.88},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-26 06:00:00"},{"dt":1737882000,"main":{"temp":8.47,"feels_like":6.11,"temp_min":8.47,"temp_max":8.47,"pressure":1014,"sea_level":1014,"grnd_level":975,"humidity":48,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":48},"wind":{"speed":4.03,"deg":171,"gust":10.62},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-26 09:00:00"},{"dt":1737892800,"main":{"temp":9.82,"feels_like":6.72,"temp_min":9.82,"temp_max":9.82,"pressure":1012,"sea_level":1012,"grnd_level":974,"humidity":48,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":74},"wind":{"speed":6.95,"deg":195,"gust":15.78},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-26 12:00:00"},{"dt":1737903600,"main":{"temp":8.73,"feels_like":5.05,"temp_min":8.73,"temp_max":8.73,"pressure":1012,"sea_level":1012,"grnd_level":974,"humidity":51,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":7.88,"deg":200,"gust":17.66},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-26 15:00:00"},{"dt":1737914400,"main":{"temp":8.74,"feels_like":4.9,"temp_min":8.74,"temp_max":8.74,"pressure":1012,"sea_level":1012,"grnd_level":973,"humidity":51,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":8.51,"deg":215,"gust":19.25},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-26 18:00:00"},{"dt":1737925200,"main":{"temp":8.73,"feels_like":4.96,"temp_min":8.73,"temp_max":8.73,"pressure":1012,"sea_level":1012,"grnd_level":973,"humidity":51,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":8.23,"deg":214,"gust":17.74},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-26 21:00:00"},{"dt":1737936000,"main":{"temp":7.3,"feels_like":3.8,"temp_min":7.3,"temp_max":7.3,"pressure":1012,"sea_level":1012,"grnd_level":973,"humidity":56,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":6.03,"deg":208,"gust":14.45},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-27 00:00:00"},{"dt":1737946800,"main":{"temp":6.02,"feels_like":1.76,"temp_min":6.02,"temp_max":6.02,"pressure":1013,"sea_level":1013,"grnd_level":973,"humidity":75,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":7.19,"deg":204,"gust":15.82},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-27 03:00:00"},{"dt":1737957600,"main":{"temp":5.69,"feels_like":1.8,"temp_min":5.69,"temp_max":5.69,"pressure":1012,"sea_level":1012,"grnd_level":973,"humidity":77,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":77},"wind":{"speed":5.93,"deg":232,"gust":13.3},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-27 06:00:00"},{"dt":1737968400,"main":{"temp":7.52,"feels_like":3.95,"temp_min":7.52,"temp_max":7.52,"pressure":1012,"sea_level":1012,"grnd_level":973,"humidity":69,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":25},"wind":{"speed":6.41,"deg":226,"gust":13.46},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-27 09:00:00"},{"dt":1737979200,"main":{"temp":8.2,"feels_like":4.4,"temp_min":8.2,"temp_max":8.2,"pressure":1011,"sea_level":1011,"grnd_level":972,"humidity":67,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":25},"wind":{"speed":7.75,"deg":219,"gust":15.38},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-27 12:00:00"},{"dt":1737990000,"main":{"temp":7.61,"feels_like":4.31,"temp_min":7.61,"temp_max":7.61,"pressure":1011,"sea_level":1011,"grnd_level":972,"humidity":69,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":5.73,"deg":227,"gust":13.05},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-27 15:00:00"},{"dt":1738000800,"main":{"temp":7.3,"feels_like":4.95,"temp_min":7.3,"temp_max":7.3,"pressure":1009,"sea_level":1009,"grnd_level":971,"humidity":63,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":87},"wind":{"speed":3.52,"deg":195,"gust":9.63},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-27 18:00:00"},{"dt":1738011600,"main":{"temp":7.58,"feels_like":5.01,"temp_min":7.58,"temp_max":7.58,"pressure":1008,"sea_level":1008,"grnd_level":970,"humidity":67,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":4.04,"deg":191,"gust":8.48},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-27 21:00:00"},{"dt":1738022400,"main":{"temp":9.64,"feels_like":7,"temp_min":9.64,"temp_max":9.64,"pressure":1007,"sea_level":1007,"grnd_level":968,"humidity":60,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":5.37,"deg":203,"gust":13.34},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-28 00:00:00"},{"dt":1738033200,"main":{"temp":9.59,"feels_like":7.01,"temp_min":9.59,"temp_max":9.59,"pressure":1006,"sea_level":1006,"grnd_level":967,"humidity":60,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":5.17,"deg":189,"gust":11.47},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-28 03:00:00"},{"dt":1738044000,"main":{"temp":9.77,"feels_like":7.15,"temp_min":9.77,"temp_max":9.77,"pressure":1005,"sea_level":1005,"grnd_level":967,"humidity":61,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":5.41,"deg":191,"gust":11.7},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-28 06:00:00"},{"dt":1738054800,"main":{"temp":9.96,"feels_like":7.13,"temp_min":9.96,"temp_max":9.96,"pressure":1005,"sea_level":1005,"grnd_level":967,"humidity":65,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":6.19,"deg":194,"gust":13.27},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-28 09:00:00"},{"dt":1738065600,"main":{"temp":12.78,"feels_like":11.55,"temp_min":12.78,"temp_max":12.78,"pressure":1003,"sea_level":1003,"grnd_level":966,"humidity":55,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":87},"wind":{"speed":6.25,"deg":205,"gust":16.17},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-28 12:00:00"},{"dt":1738076400,"main":{"temp":11.02,"feels_like":9.77,"temp_min":11.02,"temp_max":11.02,"pressure":1003,"sea_level":1003,"grnd_level":965,"humidity":61,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":68},"wind":{"speed":4.93,"deg":181,"gust":9.7},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2025-01-28 15:00:00"},{"dt":1738087200,"main":{"temp":10.27,"feels_like":9.1,"temp_min":10.27,"temp_max":10.27,"pressure":1005,"sea_level":1005,"grnd_level":966,"humidity":67,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":84},"wind":{"speed":4.51,"deg":190,"gust":10},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-28 18:00:00"},{"dt":1738098000,"main":{"temp":10.59,"feels_like":9.61,"temp_min":10.59,"temp_max":10.59,"pressure":1005,"sea_level":1005,"grnd_level":966,"humidity":73,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":4.9,"deg":193,"gust":10.98},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-28 21:00:00"},{"dt":1738108800,"main":{"temp":10.42,"feels_like":9.53,"temp_min":10.42,"temp_max":10.42,"pressure":1005,"sea_level":1005,"grnd_level":967,"humidity":77,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":3.65,"deg":180,"gust":6.88},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-29 00:00:00"},{"dt":1738119600,"main":{"temp":10.5,"feels_like":9.56,"temp_min":10.5,"temp_max":10.5,"pressure":1004,"sea_level":1004,"grnd_level":966,"humidity":75,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":5.56,"deg":187,"gust":12.45},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-29 03:00:00"},{"dt":1738130400,"main":{"temp":10.07,"feels_like":8.96,"temp_min":10.07,"temp_max":10.07,"pressure":1005,"sea_level":1005,"grnd_level":967,"humidity":70,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":7.09,"deg":201,"gust":12.84},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2025-01-29 06:00:00"}],"city":{"id":694864,"name":"Sambir","coord":{"lat":49.5183,"lon":23.1975},"country":"UA","population":35197,"timezone":7200,"sunrise":1737698966,"sunset":1737731332}}"""

    fun loadForecast(): List<ForecastData>{
        val gson = Gson()
        val convertedForecastTodayResponse = gson.fromJson(response, ForecastTodayResponse::class.java)

        return convertedForecastTodayResponse.list.map {
            ForecastData(
                time = convertLongToTimeString(it.dt),
                temp = "${it.main.temp.toInt()}℃",
                windSpeed = "${it.wind.speed.toInt()} m/s",
                weatherIcon = getWeatherItemAppearance(it.weather[0].icon).icon,
                contentDescription = it.weather[0].description
            )
        }
    }

    private fun convertLongToTimeString(timestamp: Long): String {
        val formatter = DateTimeFormatter.ofPattern("dd.MM HH:mm")
        return Instant.ofEpochSecond(timestamp)
            .atZone(ZoneId.systemDefault())
            .format(formatter)
    }
}